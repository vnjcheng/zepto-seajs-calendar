(function(global,undefined){if(global.seajs){return}var seajs=global.seajs={version:"@VERSION"};var data=seajs.data={};function isType(type){return function(obj){return{}.toString.call(obj)=="[object "+type+"]"}}var isObject=isType("Object");var isString=isType("String");var isArray=Array.isArray||isType("Array");var isFunction=isType("Function");var _cid=0;function cid(){return _cid++}var events=data.events={};seajs.on=function(name,callback){var list=events[name]||(events[name]=[]);list.push(callback);return seajs};seajs.off=function(name,callback){if(!(name||callback)){events=data.events={};return seajs}var list=events[name];if(list){if(callback){for(var i=list.length-1;i>=0;i--){if(list[i]===callback){list.splice(i,1)}}}else{delete events[name]}}return seajs};var emit=seajs.emit=function(name,data){var list=events[name];if(list){list=list.slice();for(var i=0,len=list.length;i<len;i++){list[i](data)}}return seajs};var DIRNAME_RE=/[^?#]*\//;var DOT_RE=/\/\.\//g;var DOUBLE_DOT_RE=/\/[^/]+\/\.\.\//;var MULTI_SLASH_RE=/([^:/])\/+\//g;function dirname(path){return path.match(DIRNAME_RE)[0]}function realpath(path){path=path.replace(DOT_RE,"/");path=path.replace(MULTI_SLASH_RE,"$1/");while(path.match(DOUBLE_DOT_RE)){path=path.replace(DOUBLE_DOT_RE,"/")}return path}function normalize(path){var last=path.length-1;var lastC=path.charCodeAt(last);if(lastC===35){return path.substring(0,last)}return path.substring(last-2)===".js"||path.indexOf("?")>0||lastC===47?path:path+".js"}var PATHS_RE=/^([^/:]+)(\/.+)$/;var VARS_RE=/{([^{]+)}/g;function parseAlias(id){var alias=data.alias;return alias&&isString(alias[id])?alias[id]:id}function parsePaths(id){var paths=data.paths;var m;if(paths&&(m=id.match(PATHS_RE))&&isString(paths[m[1]])){id=paths[m[1]]+m[2]}return id}function parseVars(id){var vars=data.vars;if(vars&&id.indexOf("{")>-1){id=id.replace(VARS_RE,function(m,key){return isString(vars[key])?vars[key]:m})}return id}function parseMap(uri){var map=data.map;var ret=uri;if(map){for(var i=0,len=map.length;i<len;i++){var rule=map[i];ret=isFunction(rule)?rule(uri)||uri:uri.replace(rule[0],rule[1]);if(ret!==uri)break}}return ret}var ABSOLUTE_RE=/^\/\/.|:\//;var ROOT_DIR_RE=/^.*?\/\/.*?\//;function addBase(id,refUri){var ret;var first=id.charCodeAt(0);if(ABSOLUTE_RE.test(id)){ret=id}else if(first===46){ret=(refUri?dirname(refUri):data.cwd)+id}else if(first===47){var m=data.cwd.match(ROOT_DIR_RE);ret=m?m[0]+id.substring(1):id}else{ret=data.base+id}if(ret.indexOf("//")===0){ret=location.protocol+ret}return realpath(ret)}function id2Uri(id,refUri){if(!id)return"";id=parseAlias(id);id=parsePaths(id);id=parseAlias(id);id=parseVars(id);id=parseAlias(id);id=normalize(id);id=parseAlias(id);var uri=addBase(id,refUri);uri=parseAlias(uri);uri=parseMap(uri);return uri}seajs.resolve=id2Uri;var isWebWorker=typeof window==="undefined"&&typeof importScripts!=="undefined"&&isFunction(importScripts);var IGNORE_LOCATION_RE=/^(about|blob):/;var loaderDir;var loaderPath;var cwd=!location.href||IGNORE_LOCATION_RE.test(location.href)?"":dirname(location.href);if(isWebWorker){var stack;try{var up=new Error;throw up}catch(e){stack=e.stack.split("\n")}stack.shift();var m;var TRACE_RE=/.*?((?:http|https|file)(?::\/{2}[\w]+)(?:[\/|\.]?)(?:[^\s"]*)).*?/i;var URL_RE=/(.*?):\d+:\d+\)?$/;while(stack.length>0){var top=stack.shift();m=TRACE_RE.exec(top);if(m!=null){break}}var url;if(m!=null){var url=URL_RE.exec(m[1])[1]}loaderPath=url;loaderDir=dirname(url||cwd);if(cwd===""){cwd=loaderDir}}else{var doc=document;var scripts=doc.scripts;var loaderScript=doc.getElementById("seajsnode")||scripts[scripts.length-1];function getScriptAbsoluteSrc(node){return node.hasAttribute?node.src:node.getAttribute("src",4)}loaderPath=getScriptAbsoluteSrc(loaderScript);loaderDir=dirname(loaderPath||cwd)}if(isWebWorker){function requestFromWebWorker(url,callback,charset){var error;try{importScripts(url)}catch(e){error=e}callback(error)}seajs.request=requestFromWebWorker}else{var doc=document;var head=doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement;var baseElement=head.getElementsByTagName("base")[0];var currentlyAddingScript;function request(url,callback,charset){var node=doc.createElement("script");if(charset){var cs=isFunction(charset)?charset(url):charset;if(cs){node.charset=cs}}addOnload(node,callback,url);node.async=true;node.src=url;currentlyAddingScript=node;baseElement?head.insertBefore(node,baseElement):head.appendChild(node);currentlyAddingScript=null}function addOnload(node,callback,url){var supportOnload="onload"in node;if(supportOnload){node.onload=onload;node.onerror=function(){emit("error",{uri:url,node:node});onload(true)}}else{node.onreadystatechange=function(){if(/loaded|complete/.test(node.readyState)){onload()}}}function onload(error){node.onload=node.onerror=node.onreadystatechange=null;if(!data.debug){head.removeChild(node)}node=null;callback(error)}}seajs.request=request}var cachedMods=seajs.cache={};var anonymousMeta;var fetchingList={};var fetchedList={};var callbackList={};var STATUS=Module.STATUS={FETCHING:1,SAVED:2,LOADING:3,LOADED:4,EXECUTING:5,EXECUTED:6,ERROR:7};function Module(uri,deps){this.uri=uri;this.dependencies=deps||[];this.deps={};this.status=0;this._entry=[]}Module.prototype.resolve=function(){var mod=this;var ids=mod.dependencies;var uris=[];for(var i=0,len=ids.length;i<len;i++){uris[i]=Module.resolve(ids[i],mod.uri)}return uris};Module.prototype.pass=function(){var mod=this;var len=mod.dependencies.length;for(var i=0;i<mod._entry.length;i++){var entry=mod._entry[i];var count=0;for(var j=0;j<len;j++){var m=mod.deps[mod.dependencies[j]];if(m.status<STATUS.LOADED&&!entry.history.hasOwnProperty(m.uri)){entry.history[m.uri]=true;count++;m._entry.push(entry);if(m.status===STATUS.LOADING){m.pass()}}}if(count>0){entry.remain+=count-1;mod._entry.shift();i--}}};Module.prototype.load=function(){var mod=this;if(mod.status>=STATUS.LOADING){return}mod.status=STATUS.LOADING;var uris=mod.resolve();emit("load",uris);for(var i=0,len=uris.length;i<len;i++){mod.deps[mod.dependencies[i]]=Module.get(uris[i])}mod.pass();if(mod._entry.length){mod.onload();return}var requestCache={};var m;for(i=0;i<len;i++){m=cachedMods[uris[i]];if(m.status<STATUS.FETCHING){m.fetch(requestCache)}else if(m.status===STATUS.SAVED){m.load()}}for(var requestUri in requestCache){if(requestCache.hasOwnProperty(requestUri)){requestCache[requestUri]()}}};Module.prototype.onload=function(){var mod=this;mod.status=STATUS.LOADED;for(var i=0,len=(mod._entry||[]).length;i<len;i++){var entry=mod._entry[i];if(--entry.remain===0){entry.callback()}}delete mod._entry};Module.prototype.error=function(){var mod=this;mod.onload();mod.status=STATUS.ERROR};Module.prototype.exec=function(){var mod=this;if(mod.status>=STATUS.EXECUTING){return mod.exports}mod.status=STATUS.EXECUTING;if(mod._entry&&!mod._entry.length){delete mod._entry}if(!mod.hasOwnProperty("factory")){mod.non=true;return}var uri=mod.uri;function require(id){var m=mod.deps[id]||Module.get(require.resolve(id));if(m.status==STATUS.ERROR){throw new Error("module was broken: "+m.uri)}return m.exec()}require.resolve=function(id){return Module.resolve(id,uri)};require.async=function(ids,callback){Module.use(ids,callback,uri+"_async_"+cid());return require};var factory=mod.factory;var exports=isFunction(factory)?factory(require,mod.exports={},mod):factory;if(exports===undefined){exports=mod.exports}delete mod.factory;mod.exports=exports;mod.status=STATUS.EXECUTED;emit("exec",mod);return mod.exports};Module.prototype.fetch=function(requestCache){var mod=this;var uri=mod.uri;mod.status=STATUS.FETCHING;var emitData={uri:uri};emit("fetch",emitData);var requestUri=emitData.requestUri||uri;if(!requestUri||fetchedList.hasOwnProperty(requestUri)){mod.load();return}if(fetchingList.hasOwnProperty(requestUri)){callbackList[requestUri].push(mod);return}fetchingList[requestUri]=true;callbackList[requestUri]=[mod];emit("request",emitData={uri:uri,requestUri:requestUri,onRequest:onRequest,charset:isFunction(data.charset)?data.charset(requestUri)||"utf-8":data.charset});if(!emitData.requested){requestCache?requestCache[emitData.requestUri]=sendRequest:sendRequest()}function sendRequest(){seajs.request(emitData.requestUri,emitData.onRequest,emitData.charset)}function onRequest(error){delete fetchingList[requestUri];fetchedList[requestUri]=true;if(anonymousMeta){Module.save(uri,anonymousMeta);anonymousMeta=null}var m,mods=callbackList[requestUri];delete callbackList[requestUri];while(m=mods.shift()){if(error===true){m.error()}else{m.load()}}}};Module.resolve=function(id,refUri){var emitData={id:id,refUri:refUri};emit("resolve",emitData);return emitData.uri||seajs.resolve(emitData.id,refUri)};Module.define=function(id,deps,factory){var argsLen=arguments.length;if(argsLen===1){factory=id;id=undefined}else if(argsLen===2){factory=deps;if(isArray(id)){deps=id;id=undefined}else{deps=undefined}}if(!isArray(deps)&&isFunction(factory)){deps=typeof parseDependencies==="undefined"?[]:parseDependencies(factory.toString())}var meta={id:id,uri:Module.resolve(id),deps:deps,factory:factory};if(!isWebWorker&&!meta.uri&&doc.attachEvent&&typeof getCurrentScript!=="undefined"){var script=getCurrentScript();if(script){meta.uri=script.src}}emit("define",meta);meta.uri?Module.save(meta.uri,meta):anonymousMeta=meta};Module.save=function(uri,meta){var mod=Module.get(uri);if(mod.status<STATUS.SAVED){mod.id=meta.id||uri;mod.dependencies=meta.deps||[];mod.factory=meta.factory;mod.status=STATUS.SAVED;emit("save",mod)}};Module.get=function(uri,deps){return cachedMods[uri]||(cachedMods[uri]=new Module(uri,deps))};Module.use=function(ids,callback,uri){var mod=Module.get(uri,isArray(ids)?ids:[ids]);mod._entry.push(mod);mod.history={};mod.remain=1;mod.callback=function(){var exports=[];var uris=mod.resolve();for(var i=0,len=uris.length;i<len;i++){exports[i]=cachedMods[uris[i]].exec()}if(callback){callback.apply(global,exports)}delete mod.callback;delete mod.history;delete mod.remain;delete mod._entry};mod.load()};seajs.use=function(ids,callback){Module.use(ids,callback,data.cwd+"_use_"+cid());return seajs};Module.define.cmd={};global.define=Module.define;seajs.Module=Module;data.fetchedList=fetchedList;data.cid=cid;seajs.require=function(id){var mod=Module.get(Module.resolve(id));if(mod.status<STATUS.EXECUTING){mod.onload();mod.exec()}return mod.exports};data.base=loaderDir;data.dir=loaderDir;data.loader=loaderPath;data.cwd=cwd;data.charset="utf-8";seajs.config=function(configData){for(var key in configData){var curr=configData[key];var prev=data[key];if(prev&&isObject(prev)){for(var k in curr){prev[k]=curr[k]}}else{if(isArray(prev)){curr=prev.concat(curr)}else if(key==="base"){if(curr.slice(-1)!=="/"){curr+="/"}curr=addBase(curr)}data[key]=curr}}emit("config",configData);return seajs}})(this);